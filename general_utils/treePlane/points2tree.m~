function cellVal = points2tree(val,treeStruct,method)
%POINTS2TREE - Assign value to each grid cell based on the data points in
%the cell.
%   Given an adaptively sized grid, generated with the tree2d function and
%   stored in the treeStruct data structure, assign a single value for each
%   cell based on the data points in the cell and the method chose (default
%   method: average value. 
%
%  Arguments: 
%       val - the value of the parameter for each data point.  
%       treeStruct  - data structure generated by tree2d function 
%       method  - which analysis method to be used (default - average value
if ~exist('method','var')
    method='avg';
end

cellVal=zeros(size(treeStruct.treeLevel));

for i=1:length(treeStruct.treeLevel)
    
    maskP=treeStruct.treeBLC(1,i)==treeStruct.pointsBLC(1,:) & ...
        treeStruct.treeBLC(2,i)==treeStruct.pointsBLC(2,:);
    
    
    vv=val(maskP);
    mask=~isnan(vv) & ~isinf(vv);
    
    
    switch(lower(method))
        case{'avg','mean'}
            
            cellVal(i)=sum(vv(mask))./sum(mask);
            
        case{'sum','total'}
            
            cellVal(i)=sum(vv(mask));
            
        case{'median','med'}
            cellVal(i)=median(vv(mask));
        otherwise
            error('points2tree - Illegal method: %s',method)
    end
end



end

